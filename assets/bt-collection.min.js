var BTCollection={selectors:{filter:".cf",filterContent:".cf__content",filterLink:".cf__link",filterCurrentLink:".cf__link--current-js",filterCurrentInlineLink:".cf__link--current-inline-js",filterCurrentInline:".cf__current-inline",filterLinkAuto:".cf__link--auto",filterLinkOption:".cf__link--option",filterLinkColor:".cf__link--color",filterContentAuto:".cf__item__content--auto",filterPriceSlider:".cf__price-slider",filterPriceFrom:".cf__price-from",filterPriceTo:".cf__price-to",filterPageAutoClass:"cf__link--page-auto",filterClearAll:".cf__link--clear-all",products:".collection__products",currentTags:".collection__current-tags",productsInner:".products",modeLink:".ct__mode__link",sort:".ct__sort",total:".ct__total",pagination:".pagination",scrollBtn:".collection__scroll",paginationButton:".collection__scroll,.button--more,.pagination",productGrid:".grid--products",productItem:".grid__item",recentViewWrap:".cf__item--recent-view",recentViewList:".cf__item--recent-view__content",wrap:"#collection-template"},options:{clickEvent:"click",ajaxView:"ajax"},data:{collectionUrl:"",priceSlider:[]},ignoreViewParam:function(t){return""!=t&&null!=t&&(t=t.replace(/\?view=ajax\"/g,'"').replace(/\?view=ajax\&/g,"?").replace(/\&view=ajax/g,"")),t},updateHtml:function(t,e){var i=this.selectors,n=$(i.filter,t).html();$(i.filter).html(this.ignoreViewParam(n));var r=$(i.productGrid,t);$(i.productGrid).html(r.html()),r.hasClass("grid--full")?$(i.productGrid).addClass("grid--full"):$(i.productGrid).removeClass("grid--full"),e&&($(".breadcrumbs").html($(".breadcrumbs",t).html()),$(".collection__top").html($(".collection__top",t).html())),$(i.currentTags).html(this.ignoreViewParam($(i.currentTags,t).html())),BT.reLoadReview(i.productGrid),BtCurrency.convertSilence(shopCurrency,BtCurrency.currentCurrency,$(i.wrap).find("span.money")),BT.applyCustomColorSwatches(i.products),BT.applyCustomColorSwatches(i.filter),BT.initDealCountdown(i.products),BT.popularAddedWishlistItems(i.products),0<$(i.filterCurrentInline).length&&$(i.filterCurrentInline).remove();var o=$(i.filterCurrentInline,t);0<o.length&&$(i.products).prepend(o[0].outerHTML),$(i.total).html($(i.total,t).html());var l=$(".collection__content");l.offset().top<$(window).scrollTop()&&$("html, body").animate({scrollTop:l.offset().top-100},400),0<$(this.selectors.sort).length&&($(this.selectors.sort).html($(this.selectors.sort,t).html()),$(this.selectors.sort).removeClass("active")),0<$(i.paginationButton,t).length?(0<$(i.paginationButton).length&&$(i.paginationButton).remove(),$(i.products).append($(i.paginationButton,t).get(0).outerHTML),0<$(i.scrollBtn).length&&this.initInfiniteScrollCollection(i.products)):0<$(i.paginationButton).length&&(0<$(i.scrollBtn).length&&this.destroyInfiniteScroll(),$(i.paginationButton).remove())},collectAutoFilterParams:function(t,e,i){var n=[],r={};t.length||(t=$(this.selectors.filterContent).first()),t.find(this.selectors.filterContentAuto).each(function(){var t=[];$(this).find(".current").each(function(){t.push($(this).attr("data-value"))}),0<t.length&&n.push($(this).attr("data-option-name")+"="+t.join("+"))});var o=new URLSearchParams(window.location.search);if(o.has("q")&&(r.q=o.get("q")),e&&o.has("sort_by")&&(r.sort_by=o.get("sort_by")),i&&1!==i&&n.push("btpage="+i),0<t.find(this.selectors.filterPriceSlider).length){var l=$(this.selectors.filterPriceSlider),a=l[0].noUiSlider.get(),c=1*l.attr("data-min"),s=1*l.attr("data-max");(a[0]>c||a[1]<s)&&n.push("price="+a.join("-"))}var d=n.join(",");return d&&(r.f=d),r},resetPricesliders:function(){$.each(this.data.priceSlider,function(t,e){var i=$(e);e.noUiSlider.updateOptions({start:[i.attr("data-min"),i.attr("data-max")]},!0)})},initPriceSliders:function(){var s=this;$.each(this.data.priceSlider,function(t,e){e.noUiSlider.destroy()}),this.data.priceSlider=[],$(this.selectors.filterPriceSlider).each(function(){var l=$(this),a=l.parents(s.selectors.filterContent),c=document.getElementById(l.attr("id")),t=1*$(this).attr("data-start"),e=1*$(this).attr("data-end"),i=1*$(this).attr("data-min"),n=1*$(this).attr("data-max");noUiSlider.create(c,{connect:[!1,!0,!1],start:[t,e],range:{min:i,max:n},step:1,format:{from:function(t){return Math.round(t)},to:function(t){return Math.round(t)}},direction:rtl?"rtl":"ltr"}),c.noUiSlider.on("update",function(t,e,i,n,r,o){l.parent().find(s.selectors.filterPriceFrom).html(BT.getPriceHtml(t[0])),l.parent().find(s.selectors.filterPriceTo).html(BT.getPriceHtml(t[1])),BtCurrency.convertSilence(shopCurrency,BtCurrency.currentCurrency,".cf__price span.money")}),c.noUiSlider.on("change",function(t,e,i,n,r,o){c.setAttribute("disabled",!0),s.updateNewContent(s.data.collectionUrl,s.collectAutoFilterParams(a,!0),!1,!0)}),s.data.priceSlider.push(c)})},addHistoryUrlToState:function(t,e){if(!this.inIframe())try{var i,n=this.ignoreViewParam(t);(i=null!=e&&null!=e?new URLSearchParams(e):new URLSearchParams(window.location.search)).delete("section_id"),i.delete("view");var r=i.toString();""!=r&&(t.indexOf("?")<0?n+="?":n+="&",n+=r),window.history.pushState({path:n},"",n)}catch(t){console.log(t)}},inIframe:function(){try{return window.self!==window.top}catch(t){return!0}},updateNewContent:function(e,i,n,r){BT.showLoadingFull(),i.view="ajax",BT.callAjax(e,"GET",i,null,function(t){this.updateHtml(t,n),this.initPriceSliders(),BT.hideLoadingFull(),e.indexOf("/search?")<0&&(this.data.collectionUrl=e.split("?")[0]),r&&this.addHistoryUrlToState(e,i)}.bind(this))},initAjaxLinkEvent:function(){var r=this,o=this.selectors.filterLinkAuto.replace(".",""),l="current";$(document).on(this.options.clickEvent,this.selectors.filterLink,function(t){t.preventDefault();var e=$(this),i=e.attr("href"),n={};e.hasClass(o)&&(e.hasClass(r.selectors.filterLinkOption.replace(".",""))&&e.toggleClass(l),"tooltip"==e.attr("data-toggle")&&e.tooltip("hide"),n=r.collectAutoFilterParams(e.parents(r.selectors.filterContent).first(),i.indexOf("sort_by")<0,e.hasClass(r.selectors.filterPageAutoClass)?parseInt(e.attr("data-value")):0)),"#"==i&&(i=r.data.collectionUrl),r.updateNewContent(i,n,e.hasClass("cfc__link"),!0)}),$(document).on(this.options.clickEvent,this.selectors.filterCurrentLink,function(t){t.preventDefault();$(this).attr("data-option-name");$(this).removeClass(l);var e=r.collectAutoFilterParams($(this).parents(r.selectors.filterContent),!0,0);r.updateNewContent(r.data.collectionUrl,e,!1,!0)}),$(document).on(this.options.clickEvent,this.selectors.filterCurrentInlineLink,function(t){t.preventDefault();var e=$($(this).attr("data-trigger"));0<e.length&&e.trigger("click")}),$(document).on(this.options.clickEvent,this.selectors.filterClearAll,function(t){t.preventDefault();var e=$(this).parents(r.selectors.filterContent);e.find(r.selectors.filterCurrentLink).removeClass(l);var i=r.collectAutoFilterParams(e,!0,0);r.updateNewContent(r.data.collectionUrl,i,!1,!0)})},initPopState:function(){this.addHistoryUrlToState(window.location.pathname),$(window).bind("popstate",function(t){var e=t.originalEvent.state;null!==e&&this.updateNewContent(e.path,{},!0,!1)}.bind(this))},initViewModeEvent:function(){var r=this;$(document).on(this.options.clickEvent,this.selectors.modeLink,function(t){if(t.preventDefault(),!$(this).hasClass("active")){var e;if($(this).parent().hasClass("ct__mode__grid-mobile")){e=$(".ct__mode__grid-list");var i=$(this).attr("data-mode");$('.ct__mode__grid-desktop [data-mode="'+i+'"]').parent().addClass("active")}else e=$(this).parent().siblings(".active:not(.ct__mode__grid-mobile)"),$(this).parent().hasClass("ct__mode__grid-desktop")?$(".ct__mode__grid-mobile").addClass("active").children().attr("data-mode",$(this).attr("data-mode")):$(".ct__mode__grid-mobile").removeClass("active");var n=e.children(r.selectors.modeLink).attr("data-mode");e.removeClass("active"),$(this).parent().addClass("active"),$(r.selectors.products).find(r.selectors.productGrid).removeClass(n).addClass($(this).attr("data-mode"))}})},destroyInfiniteScroll:function(){BT.destroyInfiniteScroll("collection-template")},initInfiniteScrollCollection:function(t){this.destroyInfiniteScroll(),BT.initInfiniteScroll(t)},openCurrentFilterDropdown:function(){$(".cfc__link.active").each(function(){$(this).parents(".cfc__dropdown").each(function(){var t=$(this);t.show(),t.parent(".link-list__item").addClass("open")})})},loadRecentViewProducts:function(){var t=$(this.selectors.recentViewWrap);if(0<t.length){var n=$(this.selectors.recentViewList),e=BT.getCookieItemsValue(!0,BT.options.recentView.cookieName);if(0<e.length){e.reverse();var i=Math.min(parseInt(n.attr("data-limit")),e.length),r=e.slice(0,i);BT.callAjax(theme.searchUrl,"GET",{view:"recent_view_list",q:BT.getQueryByIds(r),type:"product"},null,function(i){n.html(""),$.each(r,function(t,e){n.append($("#recent-item-"+e,i).html())}),0<n.find(".item").length&&(BT.convertCurrencySilence(n.find("span.money")),BT.reLoadReview(n),t.removeClass("hide"))})}}},init:function(){this.initAjaxLinkEvent(),this.initViewModeEvent(),BT.initExpandTrigger(),this.loadRecentViewProducts(),this.initPopState()}};theme.collectionTemplate={},theme.CollectionTemplateSection=function(t){var e=this.$container=$(t);this.obj="#"+e.attr("data-section-id"),BTCollection.data.collectionUrl=e.attr("data-url"),BtCurrency.convertSilence(shopCurrency,BtCurrency.currentCurrency,e.find("span.money")),BTCollection.initInfiniteScrollCollection(e),BT.applyCustomColorSwatches(e),BT.initDealCountdown(e.find(BTCollection.selectors.products)),BTCollection.initPriceSliders()},theme.CollectionTemplateSection.prototype=_.assignIn({},theme.CollectionTemplateSection.prototype,{onUnload:function(){BTCollection.destroyInfiniteScroll()}}),BTCollection.init(),theme.sections.constructors["collection-template"]=theme.CollectionTemplateSection;